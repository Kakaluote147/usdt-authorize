<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>USDT 授权页面</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
</head>
<body>
  <h2>USDT 授权页面</h2>
  <p>合约地址: <span id="contractAddress"></span></p>

  <label>你的地址:</label>
  <input type="text" id="owner" placeholder="0x..."><br><br>

  <label>授权地址:</label>
  <input type="text" id="spender" placeholder="0x..."><br><br>

  <label>授权数量:</label>
  <input type="text" id="amount" placeholder="1000000"><br><br>

  <button onclick="approve()">授权</button>

  <p id="status"></p>

  <script>
    const contractAddress = "TZHUExEVFtNCAh7GVTmeYkxzKZVyNpzmKE"; // 替换为你的合约地址
    document.getElementById("contractAddress").innerText = contractAddress;

    const abi = [
      {
        "constant": false,
        "inputs": [
          { "name": "_spender", "type": "address" },
          { "name": "_value", "type": "uint256" }
        ],
        "name": "approve",
        "outputs": [ { "name": "", "type": "bool" } ],
        "type": "function"
      }
    ];

    async function approve() {
      if (typeof window.ethereum === 'undefined') {
        alert("请先安装钱包插件（TronLink/MetaMask等）");
        return;
      }

      const web3 = new Web3(window.ethereum);
      await ethereum.request({ method: 'eth_requestAccounts' });

      const owner = document.getElementById("owner").value;
      const spender = document.getElementById("spender").value;
      const amount = document.getElementById("amount").value;

      const contract = new web3.eth.Contract(abi, contractAddress);

      contract.methods.approve(spender, amount).send({ from: owner })
        .on('transactionHash', function(hash){
          document.getElementById("status").innerText = "交易已发送: " + hash;
        })
        .on('receipt', function(receipt){
          document.getElementById("status").innerText = "交易成功!";
        })
        .on('error', function(error){
          document.getElementById("status").innerText = "交易失败: " + error.message;
        });
    }
  </script>
</body>
</html>
